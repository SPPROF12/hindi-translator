<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real-Time Speech-to-Text Translator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        #translation {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        .translation-box {
            width: 45%;
        }
        button {
            margin: 10px;
            padding: 10px 20px;
            font-size: 16px;
        }
        #original-text, #translated-text {
            border: 1px solid #ccc;
            padding: 10px;
            border-radius: 5px;
            height: 100px;
            overflow-y: auto;
        }
        iframe {
            width: 100%;
            height: 150px;
            border: none;
        }
    </style>
</head>
<body>
    <h1>Real-Time Speech-to-Text Translator</h1>
    <div>
        <button id="en-to-hi-btn" onmousedown="startRecording('en_to_hi')" onmouseup="stopRecording()">Press and Hold: English to Hindi</button>
        <button id="hi-to-en-btn" onmousedown="startRecording('hi_to_en')" onmouseup="stopRecording()">Press and Hold: Hindi to English</button>
    </div>
    <div id="translation">
        <div class="translation-box">
            <strong>Original:</strong><br>
            <p id="original-text"></p>
        </div>
        <div class="translation-box">
            <strong>Translation:</strong><br>
            <iframe id="translation-iframe" src=""></iframe>
        </div>
    </div>
    <div>
        <button onclick="clearText()">Clear</button>
        <button onclick="editText()">Edit</button>
    </div>
    
    <script>
        let recognition;
        let finalTranscript = '';
        let recordingDirection = '';

        function startRecording(direction) {
            if (!('webkitSpeechRecognition' in window)) {
                alert("Your browser does not support speech recognition.");
                return;
            }

            recordingDirection = direction;
            finalTranscript = ''; // Reset the final transcript each time recording starts

            recognition = new webkitSpeechRecognition();
            recognition.lang = direction === 'en_to_hi' ? 'en-US' : 'hi-IN';
            recognition.interimResults = true;
            recognition.maxAlternatives = 1;

            recognition.onresult = (event) => {
                let interimTranscript = '';
                for (let i = event.resultIndex; i < event.results.length; ++i) {
                    if (event.results[i].isFinal) {
                        finalTranscript += event.results[i][0].transcript;
                    } else {
                        interimTranscript += event.results[i][0].transcript;
                    }
                }
                document.getElementById('original-text').innerText = finalTranscript + interimTranscript;
            };

            recognition.onend = () => {
                if (finalTranscript) {
                    document.getElementById('original-text').innerText = finalTranscript;
                    updateIframe(finalTranscript, recordingDirection);
                }
            };

            recognition.onerror = (event) => {
                console.error('Speech recognition error:', event.error);
            };

            recognition.start();
        }

        function stopRecording() {
            if (recognition) {
                recognition.stop();
            }
        }

        function updateIframe(text, direction) {
            const sourceLang = direction === 'en_to_hi' ? 'en' : 'hi';
            const targetLang = direction === 'en_to_hi' ? 'hi' : 'en';
            const iframeUrl = `https://libretranslate.com/?source=${sourceLang}&target=${targetLang}&q=${encodeURIComponent(text)}`;
            document.getElementById('translation-iframe').src = iframeUrl;
        }

        function clearText() {
            document.getElementById('original-text').innerText = '';
            document.getElementById('translation-iframe').src = '';
        }

        function editText() {
            const originalText = document.getElementById('original-text');
            originalText.contentEditable = true;
            originalText.focus();
        }
    </script>
</body>
</html>
